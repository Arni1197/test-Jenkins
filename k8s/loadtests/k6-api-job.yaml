apiVersion: batch/v1
kind: Job
metadata:
  name: k6-api-smoke
  namespace: game-services
spec:
  backoffLimit: 0
  ttlSecondsAfterFinished: 600
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: k6
          image: grafana/k6:0.49.0
          args:
            - run
            - /scripts/api.js
          env:
            # üîÅ –ú–µ–Ω—è–π —Ç—É—Ç: —á–µ—Ä–µ–∑ Service –∏–ª–∏ Ingress
            - name: BASE_URL
              value: "http://api-gateway.game-services.svc.cluster.local:3000"
              # value: "http://api.local"   # –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —á–µ—Ä–µ–∑ ingress
          volumeMounts:
            - name: k6-scripts
              mountPath: /scripts
            - name: out
              mountPath: /out
      volumes:
        - name: k6-scripts
          configMap:
            name: k6-scripts
        - name: out
          emptyDir: {}