apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: backend-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: backend          # Ð¸Ð¼Ñ deploymentâ€™Ð° backend

  # ðŸ‘‡ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ð´Ð¾Ð² Ñ€Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼
  minReplicas: 1
  maxReplicas: 2           # Ð±ÐµÑ€ÐµÐ¶Ð½Ð¾ Ðº Ñ‚Ð²Ð¾Ð¸Ð¼ 8 Ð“Ð‘ Ñ Prom+Grafana

  metrics:
    # âœ… Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ° Ð¿Ð¾ CPU
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 65   # ÐµÑÐ»Ð¸ ÑÑ€ÐµÐ´Ð½ÑÑ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° CPU > 65% â†’ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´

    # âœ… Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ° Ð¿Ð¾ Ð¿Ð°Ð¼ÑÑ‚Ð¸
    - type: Resource
      resource:
        name: memory
        target:
          type: AverageValue
          averageValue: 200Mi      # ÐµÑÐ»Ð¸ ÑÑ€ÐµÐ´Ð½ÑÑ Ð¿Ð°Ð¼ÑÑ‚ÑŒ backend-Ð¿Ð¾Ð´Ð¾Ð² > 200Mi â†’ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´