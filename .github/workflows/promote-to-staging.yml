name: promote | dev -> staging (PR)

on:
  workflow_dispatch: {}

permissions:
  contents: write
  pull-requests: write

concurrency:
  group: promote-dev-to-staging
  cancel-in-progress: true

jobs:
  auth_service:
    uses: ./.github/workflows/_lib-promote-pr.yml
    with:
      service_name: "auth-service"
      target_env: "staging"
      base_branch: "main"
      source_values_file: "k8s/enviroments/local/values/services/auth-service.yaml"
      target_values_file: "k8s/enviroments/staging/values/services/auth-service.yaml"
      pr_branch_prefix: "promote"
      pr_labels: "promotion,staging"
      skip_if_exists: true

  user_service:
    uses: ./.github/workflows/_lib-promote-pr.yml
    with:
      service_name: "user-service"
      target_env: "staging"
      base_branch: "main"
      source_values_file: "k8s/enviroments/local/values/services/user-service.yaml"
      target_values_file: "k8s/enviroments/staging/values/services/user-service.yaml"
      pr_branch_prefix: "promote"
      pr_labels: "promotion,staging"
      skip_if_exists: true

  catalog_service:
    uses: ./.github/workflows/_lib-promote-pr.yml
    with:
      service_name: "catalog-service"
      target_env: "staging"
      base_branch: "main"
      source_values_file: "k8s/enviroments/local/values/services/catalog-service.yaml"
      target_values_file: "k8s/enviroments/staging/values/services/catalog-service.yaml"
      pr_branch_prefix: "promote"
      pr_labels: "promotion,staging"
      skip_if_exists: true

  api_gateway:
    uses: ./.github/workflows/_lib-promote-pr.yml
    with:
      service_name: "api-gateway"
      target_env: "staging"
      base_branch: "main"
      source_values_file: "k8s/enviroments/local/values/services/api-gateway.yaml"
      target_values_file: "k8s/enviroments/staging/values/services/api-gateway.yaml"
      pr_branch_prefix: "promote"
      pr_labels: "promotion,staging"
      skip_if_exists: true

  frontend:
    uses: ./.github/workflows/_lib-promote-pr.yml
    with:
      service_name: "frontend"
      target_env: "staging"
      base_branch: "main"
      source_values_file: "k8s/enviroments/local/values/services/frontend.yaml"
      target_values_file: "k8s/enviroments/staging/values/services/frontend.yaml"
      pr_branch_prefix: "promote"
      pr_labels: "promotion,staging"
      skip_if_exists: true