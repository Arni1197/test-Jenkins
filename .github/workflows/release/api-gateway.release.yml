name: api-gateway | release retag & sign

on:
  push:
    tags:
      - "api-gateway-v*.*.*"

permissions:
  contents: read
  packages: write
  id-token: write

concurrency:
  group: release-api-gateway-${{ github.ref }}
  cancel-in-progress: true

jobs:
  release:
    uses: ./.github/workflows/_lib/release-retag-sign.yml
    with:
      service_name: "api-gateway"
      image: "ghcr.io/${{ github.repository_owner }}/api-gateway"
      source_tag: "sha-${{ github.sha }}"
      release_tag: "${{ github.ref_name }}"
      registry: "ghcr.io"
      sign: true
      trivy_severity: "CRITICAL"
      trivy_fail: true