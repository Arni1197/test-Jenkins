name: user-service | release retag & sign

on:
  push:
    tags:
      - "user-service-v*.*.*"

permissions:
  contents: read
  packages: write
  id-token: write

concurrency:
  group: release-user-service-${{ github.ref }}
  cancel-in-progress: true

jobs:
  release:
    uses: ./.github/workflows/_lib/release-retag-sign.yml
    with:
      service_name: "user-service"
      image: "ghcr.io/${{ github.repository_owner }}/user-service"
      source_tag: "sha-${{ github.sha }}"
      release_tag: "${{ github.ref_name }}"
      registry: "ghcr.io"
      sign: true
      trivy_severity: "CRITICAL"
      trivy_fail: true